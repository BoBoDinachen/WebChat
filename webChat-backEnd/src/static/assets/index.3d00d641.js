var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,n=Object.getOwnPropertySymbols,a=Object.prototype.propertyIsEnumerable,s=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,l=(e,l)=>{for(var r in l||(l={}))t.call(l,r)&&s(e,r,l[r]);if(n)for(var r of n(l))a.call(l,r)&&s(e,r,l[r]);return e},r=(e,t,n)=>(s(e,"symbol"!=typeof t?t+"":t,n),n);import{i,F as c,a as o,b as m,c as u,w as d,N as p,S as h,R as E,p as _,L as g,d as f,e as v,f as k,g as S,h as x,t as N,B as y,P as I}from"./vendor.3fd480e2.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(n){const a=new URL(e,location),s=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((n,l)=>{const r=new URL(e,a);if(self[t].moduleMap[r])return n(self[t].moduleMap[r]);const i=new Blob([`import * as m from '${r}';`,`${t}.moduleMap['${r}']=m;`],{type:"text/javascript"}),c=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(i),onerror(){l(new Error(`Failed to import: ${e}`)),s(c)},onload(){n(self[t].moduleMap[r]),s(c)}});document.head.appendChild(c)})),self[t].moduleMap={}}}("assets/");var w="47.102.120.155:5000";const b="http://"+w;var C={currSocket:null,createSocket:function(e,t){const n=i(b,{path:"/WebChat/chat"});return this.currSocket=n,n.emit("online",{_id:e,user_name:t}),n},closeSocket:function(e){this.currSocket.emit("closeSocket",e)},openSocket:function(e){this.currSocket.open(),this.currSocket.emit("online",{uid:e})},privateChat:function(e){this.currSocket.emit("private_chat",e)},sendWorldMessage:function(e){this.currSocket.emit("world_chat",e)},friendRequest:function(e){this.currSocket.emit("friend_request",e)},requestInform:function(e){this.currSocket.emit("request_result",e)}};var B="_container_jmjql_2",M="_topBar_jmjql_12",A="_close_jmjql_20",L="_iconMore_jmjql_34",J="_floatMenus_jmjql_48",R="_menusHide_jmjql_67",H="_messageList_jmjql_70",O="_leftMessageBox_jmjql_80",T="_rightMessageBox_jmjql_80",j="_infoBox_jmjql_97",Q="_bottomBar_jmjql_173";const F="http://"+w+"/WebChat",q="http://"+w+"/WebChat/user/avatar";function z(e){return c.create({baseURL:"http://"+w+"/WebChat",timeout:5e3})(e)}var D="_container_lpnz2_1",U="_confirmBox_lpnz2_11",Z="_btns_lpnz2_24",G="_hideBox_lpnz2_45";const W=e=>{const[t,n]=o.useState(!0);function a(){n(!1),m.unmountComponentAtNode(document.getElementById("confirm-box"))}return o.createElement("div",{className:`${D} ${t?"":G}`},o.createElement("div",{className:U},o.createElement("h2",null,e.title?e.title:"这是标题"),o.createElement("p",null,e.content?e.content:"这是内容"),o.createElement("div",{className:Z},o.createElement("button",{onClick:function(){e.callBack(),a()}},"确定"),o.createElement("button",{onClick:a},"取消"))))};W.propTypes={};var K={open(e){let t=document.getElementById("confirm-box");const{title:n,content:a,hanleConfirm:s}=e;t||(t=document.createElement("div"),t.id="confirm-box",document.body.appendChild(t)),m.render(o.createElement(W,{title:n,content:a,callBack:s}),t)}};var Y="_messageBox_1fefa_1",P="_content_1fefa_23",V="_close_1fefa_33";function X(e){const{type:t,time:n,text:a,position:s,isShow:l}=e,r=o.useRef(null);function i(){r.current.style.transform="translateY(-200%)"}return o.useEffect((()=>{let e;return l&&(r.current.style.transform="none",e=setTimeout((()=>{i()}),n)),()=>{clearTimeout(e)}}),[]),o.createElement("div",{className:Y,ref:r},o.createElement("svg",{className:"icon","aria-hidden":"true"},o.createElement("use",{xlinkHref:"success"===t?"#icon-chenggong":"warning"===t?"#icon-jinggao":"#icon-shibai"})),o.createElement("div",{className:P},o.createElement("h3",null,"success"===t?"成功":"warning"===t?"警告":"错误"),o.createElement("p",null,a)),o.createElement("img",{className:V,src:"data:image/png;base64,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",onTouchEnd:i}))}function $(e){const{type:t,time:n,text:a}=e;let s=document.getElementById("toast-box");if(s)m.unmountComponentAtNode(s),m.render(o.createElement(X,{type:t,time:n,text:a,isShow:!0}),s);else{let e=document.createElement("div");e.id="toast-box",document.body.appendChild(e),m.render(o.createElement(X,{type:t,time:n,text:a,isShow:!0}),e)}}var ee="_container_eeq70_1",te="_loader_eeq70_17";function ne(e){const{size:t,loading:n,color:a}=e,s=o.useRef(null);return o.useEffect((()=>{s.current.style.display=!0===n?"flex":"none"})),o.createElement("div",{className:ee,ref:s},o.createElement("div",{className:te},o.createElement("span",null),o.createElement("span",null),o.createElement("span",null),o.createElement("span",null),o.createElement("span",null)),o.createElement("p",null,"拼命加载中..."))}function ae(e,t){var n=new Date(e),a=function(e){return(e<10?"0":"")+e};return t.replace(/yyyy|MM|dd|HH|mm|ss/g,(function(e){switch(e){case"yyyy":return a(n.getFullYear());case"MM":return a(n.getMonth()+1);case"mm":return a(n.getMinutes());case"dd":return a(n.getDate());case"HH":return a(n.getHours());case"ss":return a(n.getSeconds())}}))}class se extends o.Component{constructor(){super(...arguments),r(this,"state",{showMenus:!1,isLoading:!0}),r(this,"handleMenu1",(()=>{const{uid:e,fid:t}=this.props.location.state;setTimeout((()=>{K.open({title:"清除",content:"确定要清除聊天记录吗",hanleConfirm:()=>{z({url:"/user/clearMessages",method:"get",params:{uid:e,fid:t}}).then((e=>{console.log(e),!0===e.data.success&&(this.setState({showMenus:!this.state.showMenus}),this.props.clearMessage(),$({type:"success",time:"2000",text:"清除成功..."}))}))}})}),200)})),r(this,"back",(()=>{setTimeout((()=>{this.props.history.goBack()}),100)})),r(this,"scrollToBottom",(()=>{if(this.listBoxElem){const e=this.listBoxElem.scrollHeight-this.listBoxElem.clientHeight;this.listBoxElem.scrollTop=e>0?e:0}})),r(this,"send",(()=>{const e=this.inputElem.value,{_id:t,user_name:n}=JSON.parse(sessionStorage.user_info),{fid:a,friend_name:s}=this.props.location.state;this.props.sendMessage({uid:t,receiver_uid:a,receiver_name:s,uname:n,message:""===e?"emmm...":e,time:ae(new Date,"yyyy/MM/dd HH:mm"),status:"1"}),this.inputElem.value=""}))}componentDidMount(){const{uid:e,fid:t}=this.props.location.state;z({url:"/user/getMessages",method:"get",params:{uid:e,fid:t}}).then((e=>{console.log(e.data),e.data.success?this.props.initMessage({messages:e.data.data,callback:()=>{this.setState({isLoading:!1})}}):$({type:"warning",time:1e3,text:"消息记录为空..."}),e.data.data&&0===e.data.data.length&&$({type:"warning",time:1e3,text:"消息记录为空..."})}))}componentDidUpdate(){this.scrollToBottom()}render(){const{chatInfo:e}=this.props,{fid:t,friend_name:n,uname:a}=this.props.location.state;return o.createElement("div",{className:B},o.createElement("div",{className:M},o.createElement("span",{className:A,onTouchEnd:this.back}),n,o.createElement("span",{className:L,onClick:()=>{this.setState({showMenus:!this.state.showMenus})}}),o.createElement("ul",{className:`${J} ${this.state.showMenus?"":R}`},o.createElement("li",{onClick:this.handleMenu1},"清除消息记录"),o.createElement("li",null,"特别关心"),o.createElement("li",null,"聊天背景"))),o.createElement("ul",{className:H,ref:e=>{this.listBoxElem=e},onClick:()=>{this.setState({showMenus:!1})}},o.createElement(ne,{loading:this.state.isLoading}),e.map(((e,s)=>o.createElement("li",{ref:e=>{this.listBox=e},className:"1"===e.status?T:O,key:s},"1"===e.status?o.createElement(o.Fragment,null,o.createElement("div",{className:j},o.createElement("label",null,o.createElement("span",null,e.time),o.createElement("span",null,a)),o.createElement("div",{ref:e=>{this.messageBox=e}},e.message)),o.createElement("img",{src:F+"/user/avatar?uid="+("1"===e.status?e.uid:t),alt:""})):o.createElement(o.Fragment,null,o.createElement("img",{src:F+"/user/avatar?uid="+("1"===e.status?e.uid:t),alt:""}),o.createElement("div",{className:j},o.createElement("label",null,o.createElement("span",null,n),o.createElement("span",null,e.time)),o.createElement("div",{ref:e=>{this.messageBox=e}},e.message))))))),o.createElement("div",{className:Q},o.createElement("span",null),o.createElement("input",{type:"text",ref:e=>{this.inputElem=e},placeholder:"和ta聊聊吧~"}),o.createElement("span",null),o.createElement("button",{onTouchEnd:this.send},"发送")))}}var le=u((e=>({chatInfo:e.chatInfo})),{sendMessage:function(e){return{type:"sendMessage",data:e}},initMessage:function(e){return{type:"initMessage",data:e}},clearMessage:function(e){return{type:"clearMessage",data:e}}})(se);var re="_container_1ldv8_2",ie="_topBar_1ldv8_12",ce="_close_1ldv8_22",oe="_iconMore_1ldv8_36",me="_floatMenus_1ldv8_50",ue="_menusHide_1ldv8_69",de="_messageList_1ldv8_72",pe="_leftMessageBox_1ldv8_87",he="_rightMessageBox_1ldv8_87",Ee="_infoBox_1ldv8_104",_e="_bottomBar_1ldv8_181";var ge=d(u((e=>({worldInfo:e.worldInfo})),{sendWorldInfo:function(e){return{type:"sendWorldInfo",data:e}},clearWorldInfo:function(e){return{type:"clearWorldInfo",data:e}}})((function(e){const{_id:t,user_name:n}=JSON.parse(sessionStorage.user_info),a=o.useRef(null),s=o.useRef(null),[l,r]=o.useState(!1);return o.useEffect((()=>()=>{}),[]),o.useEffect((()=>(function(){if(a){const e=a.current.scrollHeight-a.current.clientHeight;a.current.scrollTop=e>0?e:0}}(),()=>{})),[e.worldInfo]),o.createElement("div",{className:re},o.createElement("div",{className:ie},o.createElement("span",{className:ce,onClick:()=>{e.history.replace("/home/world")}}),"世界频道",o.createElement("span",{className:oe,onClick:()=>{r((e=>!e))}}),o.createElement("ul",{className:`${l?me:ue}`},o.createElement("li",null,"更换聊天背景"),o.createElement("li",{onClick:function(){K.open({title:"确定要清除吗?",content:"清除当前显示的世界消息",hanleConfirm:()=>{e.clearWorldInfo({callback:()=>{r(!1),$({type:"success",text:"清除成功~",time:1e3})}})}})}},"清除消息"),o.createElement("li",null,"发送弹幕"),o.createElement("li",null,"匿名聊天"))),o.createElement("ul",{className:de,ref:a,onClick:()=>{r(!1)}},e.worldInfo.map(((e,n)=>o.createElement("li",{className:e.uid===t?he:pe,key:n},e.uid===t?o.createElement(o.Fragment,null,o.createElement("div",{className:Ee},o.createElement("label",null,o.createElement("span",null,e.time),o.createElement("span",null,e.uname)),o.createElement("div",null,e.message)),o.createElement("img",{src:F+"/user/avatar?uid="+e.uid,alt:""})):o.createElement(o.Fragment,null,o.createElement("img",{src:F+"/user/avatar?uid="+e.uid,alt:""}),o.createElement("div",{className:Ee},o.createElement("label",null,o.createElement("span",null,e.uname),o.createElement("span",null,e.time)),o.createElement("div",null,e.message))))))),o.createElement("div",{className:_e},o.createElement("span",null),o.createElement("input",{type:"text",ref:s,placeholder:"和ta聊聊吧~"}),o.createElement("span",null),o.createElement("button",{onClick:function(){let a=s.current.value;e.sendWorldInfo({message:{uid:t,uname:n,time:ae(new Date,"yyyy/MM/dd HH:mm"),message:""===a?"emm...":a},callback:()=>{s.current.value=""}})}},"发送")))})));var fe="_footer_mwk2s_1",ve="_navList_mwk2s_8";var ke="_list_item_1q66z_1",Se="_link_1q66z_10",xe="_active_1q66z_18";class Ne extends o.Component{componentDidMount(){const{id:e}=this.props;switch(e){case"001":this.imgElem.src="./assets/广场.01c76cee.png";break;case"002":this.imgElem.src="./assets/好友.3321bbfa.png";break;case"003":this.imgElem.src="./assets/消息.352afc16.png";break;case"004":this.imgElem.src="./assets/个人中心.c04eb22f.png"}}render(){return o.createElement("li",{className:ke},o.createElement(p,l(l({},this.props),{activeClassName:xe,className:Se}),o.createElement("img",{ref:e=>{this.imgElem=e}}),o.createElement("span",null,this.props.menu)))}}class ye extends o.Component{render(){return o.createElement(o.Fragment,null,o.createElement("footer",{className:fe},o.createElement("ul",{className:ve},[{id:"001",path:"/home",name:"广场"},{id:"002",path:"/friends",name:"好友"},{id:"003",path:"/message",name:"消息"},{id:"004",path:"/profile",name:"我的"}].map(((e,t)=>o.createElement(Ne,{to:e.path,id:e.id,menu:e.name,key:e.id}))))))}}var Ie=d(ye);var we={container:"_container_wyn9f_2",title:"_title_wyn9f_7"};class be extends o.Component{constructor(){super(...arguments),r(this,"handleBack",(()=>{const{goBack:e}=this.props.history;e()}))}componentDidMount(){}render(){let e="";const{pathname:t}=this.props.location;switch(-1!=t.search("/home")&&(e="广场"),t){case"/profile":e="个人中心";break;case"/profile/edit":e="编辑资料";break;case"/profile/updatePassword":e="修改密码";break;case"/friends":e="我的好友";break;case"/friends/search":e="搜索好友";break;case"/message":case"/message/friendMsg":e="好友消息";break;case"/message/likeMsg":e="收到的喜欢";break;case"/message/requestMsg":e="好友申请"}return o.createElement("header",{className:we.container},o.createElement("h2",{className:we.title},""==t?o.createElement("span",{className:we.back,onTouchEnd:this.handleBack}):"",e))}}var Ce=d(be);function Be(e){const t=document.body.clientHeight;e.current?(e.current.style.height=t-113+"px",e.current.style.padding="5px 10px 5px",e.current.style.boxSizing="border-box"):(e.style.height=t-113+"px",e.style.padding="5px 10px 5px",e.style.boxSizing="border-box")}var Me="_container_dtsx4_1",Ae="_menuButton_dtsx4_10",Le="_avatarBox_dtsx4_19",Je="_avatar_dtsx4_19",Re="_tagList_dtsx4_32",He="_profileInfo_dtsx4_53",Oe="_infoBox_dtsx4_61",Te="_info_dtsx4_61",je="_editButton_dtsx4_87",Qe="_infoTag_dtsx4_93",Fe="_menuBar_dtsx4_114",qe="_cardTitle_dtsx4_148",ze="_cardBox_dtsx4_156",De="_card_dtsx4_148",Ue="_cardFirst_dtsx4_202",Ze="_cardSecond_dtsx4_205",Ge="_cardThirdly_dtsx4_208";var We="_container_55hpt_2",Ke="_titleBar_55hpt_12",Ye="_formBox_55hpt_40",Pe="_activeItem_55hpt_94";var Ve=d((function(e){const t=o.useRef(),n=o.useRef(),a=o.useRef(),s=o.useRef(),[l,r]=o.useState(""),[i,c]=o.useState({});return o.useEffect((()=>{z({url:"/user/profile",method:"get",params:{uid:JSON.parse(sessionStorage.user_info)._id}}).then((e=>{let t=e.data.data;r(t.sex),c(t)}),(e=>{console.log(e)}))}),[]),o.createElement("div",{className:We,ref:t},o.createElement("div",{className:Ke},o.createElement("span",{onClick:()=>{e.history.goBack()}},"返回"),o.createElement("h3",null,"编辑个人资料")),o.createElement("div",{className:Ye},o.createElement("div",null,o.createElement("label",null,"昵称"),o.createElement("input",{ref:n,type:"text",placeholder:"尊姓大名",defaultValue:i.user_name})),o.createElement("div",null,o.createElement("label",null,"年龄"),o.createElement("input",{ref:a,type:"text",placeholder:"输入你的年龄",defaultValue:i.age})),o.createElement("div",null,o.createElement("label",null,"个性签名"),o.createElement("textarea",{ref:s,defaultValue:i.signature})),o.createElement("div",null,o.createElement("label",null,"性别"),o.createElement("ul",null,o.createElement("li",{className:"男"===l?Pe:"",onClick:()=>{r("男")}},"男"),o.createElement("li",{className:"女"===l?Pe:"",onClick:()=>{r("女")}},"女"))),o.createElement("button",{onClick:function(){let t=n.current.value,r=a.current.value,i=s.current.value;z({url:"/user/updateProfile",method:"post",data:{uid:JSON.parse(sessionStorage.user_info)._id,uname:t,age:r,signature:i,sex:l}}).then((t=>{console.log(t.data),t.data.isUpdate&&($({type:"success",text:"保存成功",time:1e3}),e.history.updateProfile(),e.history.goBack())}),(e=>{console.log(e)}))}},"保存")))}));var Xe="_container_13bad_2",$e="_titleBar_13bad_11",et="_formBox_13bad_39";var tt=d((function(e){const[t,n]=o.useState(!1),a=o.useRef(null),s=o.useRef(null),l=o.useRef(null),r=JSON.parse(sessionStorage.user_info).password;return o.useEffect((()=>{a.current.type=t?"text":"password"}),[t]),o.createElement("div",{className:Xe},o.createElement("div",{className:$e},o.createElement("span",{onClick:()=>{e.history.goBack()}},"返回"),o.createElement("h3",null,"设置您的密码")),o.createElement("div",{className:et},o.createElement("div",null,o.createElement("label",null,"原来的密码"),o.createElement("div",null,o.createElement("input",{type:"password",ref:a,defaultValue:r}),o.createElement("svg",{className:"icon","aria-hidden":"true",onClick:()=>{n(!t)}},o.createElement("use",{xlinkHref:t?"#icon-yanjing":"#icon-yanjing1"})))),o.createElement("div",null,o.createElement("label",null,"新的密码"),o.createElement("div",null,o.createElement("input",{type:"password",ref:s}),o.createElement("svg",{className:"icon","aria-hidden":"true"},o.createElement("use",{xlinkHref:"#icon-mima"})))),o.createElement("div",null,o.createElement("label",null,"确认密码"),o.createElement("div",null,o.createElement("input",{type:"password",ref:l}),o.createElement("svg",{className:"icon","aria-hidden":"true"},o.createElement("use",{xlinkHref:"#icon-mima"}))))),o.createElement("button",{onClick:function(){s.current.value===l.current.value?(l.current.style.border="",K.open({title:"确定修改吗?",content:"修改密码成功后，会进入登录页面，请重新登录！",hanleConfirm:()=>{z({url:"/user/updatePassword",method:"post",data:{uid:JSON.parse(sessionStorage.user_info)._id,pwd:l.current.value}}).then((t=>{if(console.log(t),t.data.isUpdate){$({type:"success",text:"修改成功~",time:1e3}),e.history.push("/profile");let t=JSON.parse(sessionStorage.user_info);C.closeSocket(t._id),window.localStorage.setItem("user_login",JSON.stringify({_id:t._id,account:t.account,password:""})),window.sessionStorage.clear(),window.location.reload()}}),(e=>{console.log(e)}))}})):($({type:"warning",text:"两次密码不一致~",time:1e3}),l.current.style.border="1px solid #FF6666")}},"确定"))}));class nt extends o.Component{constructor(){super(...arguments),r(this,"userInfo",JSON.parse(sessionStorage.getItem("user_info"))),r(this,"state",{isUpdate:!1,user:{uid:this.userInfo._id},likeList:[],followList:[],messageTotal:[]}),r(this,"HandleAvatar",(()=>{alert("喵呜~")})),r(this,"initializeInfo",(()=>{Promise.all([this.getUserInfo(),this.getLikeList(),this.getMessageTotal()]).then((e=>{e.forEach((e=>{console.log(e)}))}))})),r(this,"uploadAvatar",(()=>{const e=this.uploadElem.files[0];if(("image/jpeg"===e.type||"image/png"===e.type)&&e.size<=2e6){const{user:t}=this.state,n=new FormData;n.append("avatar",e),n.append("uid",t.uid),K.open({title:"更换头像",content:"确定选择这张头像吗?",hanleConfirm:()=>{this.hiddenMenuBar(),z({url:"/user/upload/profile",method:"post",headers:{"Content-Type":"multipart/form-data"},data:n}).then((e=>{if(console.log(e.data),e.data.setAvatar){$({type:"success",text:"已更换头像",time:1e3});let t=JSON.parse(window.sessionStorage.getItem("user_info"));t.avatar_url=e.data.url,window.sessionStorage.setItem("user_info",JSON.stringify(t)),setTimeout((()=>{this.setState({user:{uid:t._id,account:t.account,user_name:t.user_name,age:t.age,sex:t.sex,avatar_url:e.data.url,signature:t.signature}})}),500)}})).catch((e=>{console.log(e)}))}})}else alert("请选择jpg或者png格式的图片,并且不大于2MB噢~")})),r(this,"goToEdit",(()=>{this.props.history.push("/profile/edit"),this.props.history.updateProfile=()=>{this.getUserInfo()}})),r(this,"backLogin",(()=>{const{_id:e,account:t}=this.userInfo;setTimeout((()=>{K.open({title:"退出登录",content:"确定要退出登录吗?",hanleConfirm:()=>{C.closeSocket(e),window.localStorage.setItem("user_login",JSON.stringify({_id:e,account:t,password:""})),window.sessionStorage.clear(),window.location.reload()}})}),200)})),r(this,"showMenuBar",(()=>{this.menuBarElem.style.display="flex"})),r(this,"hiddenMenuBar",(()=>{this.menuBarElem.style.display="none"}))}componentDidUpdate(e,t){console.log("Profile组件更新...");const{user:n}=this.state;""!==n.avatar_url&&(console.log(n),this.getAvatar(n.uid))}componentDidMount(){console.log("组件加载"),Be(this.containerBox),this.initializeInfo()}getAvatar(e){z({url:"/user/avatar",method:"get",params:{uid:e},responseType:"blob"}).then((e=>{const t=window.URL.createObjectURL(e.data);this.avatarElem.src=t})).catch((e=>{console.log(e)}))}getUserInfo(){return new Promise(((e,t)=>{z({url:"/user/profile",method:"get",params:{uid:this.userInfo._id}}).then((t=>{let n=t.data.data;console.log("用户信息",n),n&&this.setState({user:{uid:n._id,account:n.account,user_name:n.user_name,age:n.age,sex:n.sex,avatar_url:n.avatar_url,signature:n.signature}},(()=>{e("基本信息加载完成..."),sessionStorage.setItem("user_info",JSON.stringify(n))}))}),(e=>{t(e)}))}))}getLikeList(){return new Promise(((e,t)=>{z({url:"/user/getLikeNumbers",method:"get",params:{uid:this.userInfo._id}}).then((t=>{if(t.data.success){let n=t.data.data;this.setState({likeList:n.likeList,followList:n.followList},(()=>{e("加载喜欢与被喜欢列表完成...")}))}else this.setState({likeList:[],followList:[]},(()=>{e("加载喜欢与被喜欢列表完成...")}))}),(e=>{t(e)}))}))}getMessageTotal(){return new Promise(((e,t)=>{z({url:"/user/getMessageTotal",method:"get",params:{uid:this.userInfo._id}}).then((t=>{t.data.success,this.setState({messageTotal:t.data.total},(()=>{e("加载消息条数完成...")}))}),(e=>{t(e)}))}))}render(){const{user:e}=this.state;return o.createElement("div",{className:Me,ref:e=>{this.containerBox=e}},o.createElement("div",{className:Ae},o.createElement("svg",{className:"icon","aria-hidden":"true",onClick:this.showMenuBar},o.createElement("use",{xlinkHref:"#icon-caidan-2-xian"}))),o.createElement("div",{className:Le,onClick:this.hiddenMenuBar},o.createElement("img",{className:Je,onClick:this.HandleAvatar,ref:e=>{this.avatarElem=e},src:`${q}?uid=${e.uid}`,alt:""}),o.createElement("div",{className:Re},o.createElement("div",null,o.createElement("span",null,this.state.likeList.length),o.createElement("span",null,"我喜欢")),o.createElement("div",null,o.createElement("span",null,this.state.followList.length),o.createElement("span",null,"喜欢我")),o.createElement("div",null,o.createElement("span",null,this.state.messageTotal),o.createElement("span",null,"发消息")))),o.createElement("div",{className:He,onClick:this.hiddenMenuBar},o.createElement("div",{className:Oe},o.createElement("div",{className:Te},o.createElement("span",null,e.user_name),o.createElement("span",null,e.account),o.createElement("span",null,e.signature)),o.createElement("span",{className:je,onClick:this.goToEdit},o.createElement("svg",{className:"icon","aria-hidden":"true"},o.createElement("use",{xlinkHref:"#icon-bianji"})),"  编辑资料")),o.createElement("div",{className:Qe},o.createElement("span",null,o.createElement("svg",{className:"icon","aria-hidden":"true"},o.createElement("use",{xlinkHref:"女"===e.sex?"#icon-nv":"#icon-nan1"})),e.sex),o.createElement("span",null,e.age),o.createElement("span",null,"金牛座"))),o.createElement("div",{className:Fe,ref:e=>{this.menuBarElem=e}},o.createElement("span",null,"更换头像",o.createElement("input",{type:"file",ref:e=>{this.uploadElem=e},onChange:this.uploadAvatar})),o.createElement("span",{onClick:()=>{setTimeout((()=>{this.props.history.push("/profile/updatePassword")}),300)}},"修改密码"),o.createElement("span",{onClick:this.backLogin},"退出登录")),o.createElement("label",{className:qe},"我的系统"),o.createElement("div",{className:ze,onClick:this.hiddenMenuBar},o.createElement("div",{className:`${De} ${Ue}`},o.createElement("div",null,o.createElement("svg",{className:"icon","aria-hidden":"true"},o.createElement("use",{xlinkHref:"#icon-qiandai2"}))),o.createElement("div",null,o.createElement("span",null,"钱袋"),o.createElement("span",null,"999金"))),o.createElement("div",{className:`${De} ${Ze}`},o.createElement("div",null,o.createElement("svg",{className:"icon","aria-hidden":"true"},o.createElement("use",{xlinkHref:"#icon-renwu"}))),o.createElement("div",null,o.createElement("span",null,"任务"),o.createElement("span",null,"0/10"))),o.createElement("div",{className:`${De} ${Ge}`},o.createElement("div",null,o.createElement("svg",{className:"icon","aria-hidden":"true"},o.createElement("use",{xlinkHref:"#icon-ziyuan"}))),o.createElement("div",null,o.createElement("span",null,"宠物"),o.createElement("span",null,"v.100")))),o.createElement(h,null,o.createElement(E,{path:"/profile/edit",component:Ve}),o.createElement(E,{path:"/profile/updatePassword",component:tt})))}}var at=d(nt);var st="_container_5kp79_2",lt="_searchBox_5kp79_10",rt="_listBox_5kp79_40",it="_nullBox_5kp79_60",ct="_friendList_5kp79_81",ot="_rightBox_5kp79_110";var mt="_containerShell_1sgs1_2",ut="_container_1sgs1_2",dt="_infoBox_1sgs1_25",pt="_rightBox_1sgs1_40",ht="_menuList_1sgs1_75",Et="_menu1_1sgs1_81",_t="_menu4_1sgs1_81",gt="_menu3_1sgs1_81",ft="_menu2_1sgs1_81",vt="_photoWall_1sgs1_132";class kt extends o.Component{constructor(){super(...arguments),r(this,"state",{friendInfo:{},isLike:!1}),r(this,"goToChat",(()=>{const{_id:e,user_name:t}=this.state.friendInfo;setTimeout((()=>{this.props.history.replace("/privateChat",{uid:JSON.parse(sessionStorage.user_info)._id,fid:e,friend_name:t,uname:JSON.parse(sessionStorage.user_info).user_name})}),300)})),r(this,"deleteFriend",(()=>{const{handleDelete:e}=this.props,{friendInfo:t}=this.state;setTimeout((()=>{K.open({title:"删除好友",content:"确定要删除此好友吗?",hanleConfirm:()=>{z({url:"/user/deleteFriend",method:"post",data:{uid:JSON.parse(sessionStorage.user_info)._id,fid:t._id}}).then((n=>{console.log(n),n.data.success&&(e(t),this.closeBox(),$({type:"success",time:2e3,text:"删除成功!"}))}))}})}),300)})),r(this,"checkLike",(()=>{z({url:"/user/checkLike",method:"post",data:{uid:JSON.parse(sessionStorage.user_info)._id,fid:this.state.friendInfo._id}}).then((e=>{e.data.success?this.setState({isLike:!1}):this.setState({isLike:!0})}),(e=>{console.log(e)}))})),r(this,"clickLike",(()=>{z({url:"/user/clickLike",method:"post",data:{uid:JSON.parse(sessionStorage.user_info)._id,fid:this.state.friendInfo._id}}).then((e=>{e.data.success&&($({type:"success",text:"已喜欢上了♥",time:1e3}),this.setState({isLike:!0}))}),(e=>{console.log(e)}))})),r(this,"cancelLike",(()=>{setTimeout((()=>{K.open({title:"取消喜欢",content:"确定要取消吗?",hanleConfirm:()=>{z({url:"/user/cancelLike",method:"post",data:{uid:JSON.parse(sessionStorage.user_info)._id,fid:this.state.friendInfo._id}}).then((e=>{console.log(e),e.data.success&&($({type:"success",text:"已取消喜欢",time:1e3}),this.setState({isLike:!1}))}),(e=>{console.log(e)}))}})}),300)})),r(this,"closeBox",(()=>{setTimeout((()=>{this.props.close()}),100)}))}componentDidMount(){this.token=_.subscribe("currSelectFriend",((e,t)=>{const n=JSON.parse(t);console.log(n),this.setState({friendInfo:n},(()=>{this.checkLike()}))}))}componentWillUnmount(){_.unsubscribe(this.token)}render(){let{isShow:e}=this.props;const{friendInfo:t,isLike:n}=this.state;return o.createElement(o.Fragment,null,o.createElement("div",{className:mt,style:{display:e?"block":"none"}},o.createElement("div",{className:ut,ref:e=>{this.boxElem=e}},o.createElement("div",{className:dt},o.createElement("img",{src:F+"/user/avatar?uid="+t._id}),o.createElement("div",{className:pt},o.createElement("h2",null,t.user_name),o.createElement("span",null,t.account),o.createElement("label",null,o.createElement("svg",{className:"icon","aria-hidden":"true"},o.createElement("use",{xlinkHref:"女"===t.sex?"#icon-nv":"#icon-nan1"})),t.age,"岁"),o.createElement("span",null,""===t.signature?"这个好友还没有设置签名噢~":t.signature))),o.createElement("ul",{className:ht},o.createElement("li",{className:Et,onTouchEnd:this.goToChat},o.createElement("span",null),o.createElement("label",null,"聊天")),o.createElement("li",{className:ft,onClick:this.deleteFriend},o.createElement("span",null),o.createElement("label",null,"删除")),n?o.createElement("li",{className:_t,onClick:this.cancelLike},o.createElement("span",null),o.createElement("label",null,"取消喜欢")):o.createElement("li",{className:gt,onClick:this.clickLike},o.createElement("span",null),o.createElement("label",null,"喜欢ta"))),o.createElement("div",{className:vt},o.createElement("label",null,"照片墙,待开发....")),o.createElement("span",{onTouchEnd:this.closeBox}))))}}var St=d(kt);var xt="_container_1am0w_1",Nt="_headerBox_1am0w_8",yt="_searchBox_1am0w_15",It="_searchListBox_1am0w_43",wt="_showNull_1am0w_49",bt="_title_1am0w_59",Ct="_resultBox_1am0w_67",Bt="_userInfo_1am0w_82",Mt="_FriendBox_1am0w_109",At="_UserBox_1am0w_114";var Lt=d((function(e){function t(e){K.open({title:"添加好友",content:"将发送申请给对方噢~",hanleConfirm:()=>{C.friendRequest({uid:JSON.parse(sessionStorage.user_info)._id,uname:JSON.parse(sessionStorage.user_info).user_name,fid:e._id,fname:e.user_name,time:ae(new Date,"yyyy-MM-dd HH:mm")}),$({type:"success",time:1e3,text:"发送申请成功~"})}})}return o.useEffect((()=>{console.log("组件加载")}),[]),0===e.userList.length?o.createElement("li",{className:wt},"搜索结果为空"):o.createElement(o.Fragment,null,o.createElement("div",{className:bt},"搜索结果"),e.userList.map((e=>o.createElement("li",{key:e._id,className:Ct},o.createElement("img",{src:F+"/user/avatar?uid="+e._id}),o.createElement("div",{className:Bt},o.createElement("span",null,`${e.user_name}(${e.account.split("@")[0]})`),o.createElement("div",null,o.createElement("svg",{className:"icon","aria-hidden":"true"},o.createElement("use",{xlinkHref:"女"===e.sex?"#icon-nv":"#icon-nan1"})),o.createElement("span",null,e.age,"岁"),"    ",o.createElement("span",null,e.signature))),e.isFriend?o.createElement("div",{className:Mt},"已添加"):o.createElement("div",{className:At,onClick:t.bind(this,e)},o.createElement("svg",{className:"icon","aria-hidden":"true"},o.createElement("use",{xlinkHref:"#icon-jia"})),"加好友")))))}));var Jt=d((function(e){const t=o.useRef(null),n=o.useRef(null),[a,s]=o.useState([]),[l,r]=o.useState(!1);o.useEffect((()=>{n.current.style.height=document.body.clientHeight-100+"px"}),[]);const i=(c=function(e){""!=e?(console.log(e),z({url:"/user/searchFriend",method:"get",params:{content:e,uid:JSON.parse(window.sessionStorage.user_info)._id}}).then((e=>{s(e.data.data),r(!1)}))):(r(!1),s([]))},m=500,function(e){let t=this,n=e;clearTimeout(c.id),c.id=setTimeout((function(){c.call(t,n)}),m)});var c,m;return o.createElement("div",{className:xt},o.createElement("div",{className:Nt},o.createElement("div",{className:yt},o.createElement("span",null,o.createElement("svg",{className:"icon","aria-hidden":"true"},o.createElement("use",{xlinkHref:"#icon-sousuo"}))),o.createElement("input",{type:"text",autoFocus:!0,placeholder:"搜索好友/其他用户 账号/昵称",onInput:e=>{r(!0),i(t.current.value)},ref:t})),o.createElement("a",{href:"#",onClick:()=>{e.history.replace("/friends")}},"返回")),o.createElement("ul",{className:It,ref:n},o.createElement(ne,{loading:l}),o.createElement(Lt,{userList:a})))}));class Rt extends o.Component{constructor(){super(...arguments),r(this,"uid",JSON.parse(sessionStorage.user_info)._id),r(this,"state",{friends:[],isShowInfo:!1,isLoading:!0}),r(this,"closeInfoBox",(()=>{this.setState({isShowInfo:!1})})),r(this,"addFriend",(e=>{console.log(e),this.setState(((t,n)=>({friends:[...t.friends,e]})))})),r(this,"deleteFriend",(e=>{console.log(e);let t=this.state.friends.filter((t=>t._id!=e._id));this.setState({friends:t})})),r(this,"enterIntoSearch",(()=>{this.props.history.replace({pathname:"/friends/search",state:{},callback:this.addFriend}),this.searchElem.blur()}))}componentDidMount(){console.log("Friends组件触发"),Be(this.containerElem),z({url:"/user/getFriends",method:"get",params:{uid:this.uid}}).then((e=>{const{data:t}=e.data;console.log("好友列表",t),this.setState({friends:t,isLoading:!1})})).catch((e=>{console.log(e)}))}showInfoBox(){this.setState({isShowInfo:!0})}selectFriend(e){setTimeout((()=>{this.showInfoBox(),_.publish("currSelectFriend",JSON.stringify(e))}),300)}render(){return o.createElement(o.Fragment,null,o.createElement(h,null,o.createElement(E,{path:"/friends/search",component:Jt})),o.createElement(St,{isShow:this.state.isShowInfo,close:this.closeInfoBox,handleDelete:this.deleteFriend}),o.createElement("div",{className:st,ref:e=>{this.containerElem=e}},o.createElement("div",{className:lt},o.createElement("input",{type:"text",placeholder:"搜索~",ref:e=>{this.searchElem=e},onFocus:this.enterIntoSearch}),o.createElement("span",null)),o.createElement("div",{className:rt},o.createElement("span",null,"好友列表( ",this.state.friends.length," )"),o.createElement(ne,{loading:this.state.isLoading}),0===this.state.friends.length?o.createElement("div",{className:it},o.createElement("svg",{className:"icon","aria-hidden":"true"},o.createElement("use",{xlinkHref:"#icon-lvyou"})),o.createElement("span",null,"快去添加好友叭~")):o.createElement("ul",{className:ct},this.state.friends.map(((e,t)=>o.createElement("li",{onClickCapture:this.selectFriend.bind(this,e),key:e._id},o.createElement("img",{src:F+"/user/avatar?uid="+e._id}),o.createElement("div",{className:ot},o.createElement("h4",null,e.user_name),o.createElement("p",null,""===e.signature?"这个好友还没有签名噢~":e.signature)))))))))}}var Ht=d(Rt);var Ot="_container_1q2xi_2",Tt="_messageTitle_1q2xi_10",jt="_titleItem_1q2xi_19",Qt="_titleItem3_1q2xi_19",Ft="_titleItem2_1q2xi_19",qt="_active_1q2xi_46";var zt="_messageList_1iq1g_1";class Dt extends o.Component{render(){return o.createElement("ul",{className:zt},o.createElement(ne,{loading:!0}))}}var Ut="_messageList_1iq1g_1";class Zt extends o.Component{render(){return o.createElement("ul",{className:Ut},o.createElement("li",null,"这是收到的喜欢列表"))}}var Gt="_messageList_cgk2n_1",Wt="_infoBox_cgk2n_21",Kt="_status0_cgk2n_36",Yt="_status1_cgk2n_40",Pt="_status2_cgk2n_58",Vt="_status3_cgk2n_62";function Xt(){const[e,t]=o.useState([]),[n,a]=o.useState(!1),[s,l]=o.useState(!0);function r(e){z({url:"/message/addFriend",method:"post",data:{uid:JSON.parse(sessionStorage.user_info)._id,uname:JSON.parse(sessionStorage.user_info).user_name,incr_uid:e.fid,fname:e.fname}}).then((t=>{console.log(t.data),t.data.success&&($({type:"success",text:"同意申请成功~",time:1e3}),C.requestInform({uid:JSON.parse(sessionStorage.user_info)._id,fid:e.fid,status:2}),a(!n))}))}function i(e){z({url:"/message/refuseRequest",method:"post",data:{uid:JSON.parse(sessionStorage.user_info)._id,fid:e.fid}}).then((t=>{console.log(t.data),"OK"===t.data.status&&(C.requestInform({uid:JSON.parse(sessionStorage.user_info)._id,fid:e.fid,status:3}),a(!n))}))}return o.useEffect((()=>(console.log("组件加载..."),z({url:"/message/getRequestList",method:"get",params:{uid:JSON.parse(sessionStorage.user_info)._id}}).then((e=>{console.log("申请列表:",e.data),e.data.data?(t(e.data.data),l(!1)):(t([]),l(!1))})),()=>{})),[n]),o.createElement("ul",{className:Gt},o.createElement(ne,{loading:s}),0===e.length?o.createElement("div",{style:{marginTop:"20px"}},o.createElement("h3",null,"还没有申请记录噢~")):e.map((e=>o.createElement("li",{key:e.fid},o.createElement("img",{src:q+"?uid="+e.fid,alt:""}),o.createElement("div",{className:Wt},o.createElement("span",null,e.fname),o.createElement("span",null,e.request_time)),0===e.request_status?o.createElement("span",{className:Kt},"等待验证"):1===e.request_status?o.createElement("div",{className:Yt},o.createElement("button",{onClick:r.bind(this,e)},"同意"),o.createElement("button",{onClick:i.bind(this,e)},"拒绝")):2===e.request_status?o.createElement("span",{className:Pt},"已同意"):3===e.request_status?o.createElement("span",{className:Vt},"已拒绝"):o.createElement(o.Fragment,null)))))}class $t extends o.Component{constructor(){super(...arguments),r(this,"uid",JSON.parse(sessionStorage.user_info)._id),r(this,"state",{currentIndex:"title1"})}componentDidMount(){Be(this.containerElem),this.props.history.push("/message/friendMsg")}handelChange(e){switch(e){case"item1":this.setState({currentIndex:"title1"},(()=>{this.props.history.push("/message/friendMsg")}));break;case"item2":this.setState({currentIndex:"title2"},(()=>{this.props.history.push("/message/requestMsg")}));break;case"item3":this.setState({currentIndex:"title3"},(()=>{this.props.history.push("/message/likeMsg")}))}}render(){return o.createElement("div",{className:Ot,ref:e=>{this.containerElem=e}},o.createElement("div",{className:Tt},o.createElement("div",{className:`${jt} ${"title1"===this.state.currentIndex?qt:null}`},o.createElement("span",{onTouchEnd:this.handelChange.bind(this,"item1")})),o.createElement("div",{className:`${Ft} ${"title2"===this.state.currentIndex?qt:null}`},o.createElement("span",{onTouchEnd:this.handelChange.bind(this,"item2")})),o.createElement("div",{className:`${Qt} ${"title3"===this.state.currentIndex?qt:null}`},o.createElement("span",{onTouchEnd:this.handelChange.bind(this,"item3")}))),o.createElement(h,null,o.createElement(E,{path:"/message",exact:!0,component:Dt}),o.createElement(E,{path:"/message/friendMsg",component:Dt}),o.createElement(E,{path:"/message/likeMsg",component:Zt}),o.createElement(E,{path:"/message/requestMsg",component:Xt})))}}var en=d($t);var tn="_container_op0cv_1",nn="_topBar_op0cv_9",an="_activeItem_op0cv_37";var sn="_container_79xjy_1";function ln(){return o.createElement("div",{className:sn},o.createElement("h2",null,"这是小卖部"))}var rn="_container_79xjy_1";function cn(){return o.createElement("div",{className:rn},o.createElement("h2",null,"这是水果摊"))}var on="_container_79xjy_1";function mn(){return o.createElement("div",{className:on},o.createElement(ne,{loading:!0}))}var un="_container_1fehz_2",dn="_titleBar_1fehz_8";var pn=d((function(e){return o.createElement("div",{className:un},o.createElement("div",{className:dn},o.createElement("span",{onClick:()=>{e.history.goBack()}},"返回"),o.createElement("h3",null,"留下你的照片")))}));var hn="_container_o4z2r_2",En="_bjBottom_o4z2r_6",_n="_statusBox_o4z2r_20",gn="_upward_o4z2r_42",fn="_downward_o4z2r_51",vn="_warpBox_o4z2r_83",kn="_rotateBox_o4z2r_99",Sn="_btnBox_o4z2r_107",xn="_box2_o4z2r_107";var Nn=d((function(e){const t=o.useRef(null),[n,a]=o.useState(!1);return o.useEffect((()=>(t.current.style.height=n?"100%":"40%",()=>{})),[n]),o.createElement("div",{className:hn},o.createElement("div",{className:vn},o.createElement("div",{className:kn},o.createElement("span",null),o.createElement("span",null),o.createElement("span",null),o.createElement("span",null),o.createElement("span",null),o.createElement("span",null)),o.createElement("div",{className:Sn,onClick:()=>{setTimeout((()=>{e.history.replace("/worldChat")}),300)}},"进入",o.createElement("div",{className:xn}))),o.createElement("div",{className:En,ref:t},o.createElement("div",{className:_n},o.createElement("span",null,"大世界"),o.createElement("span",null,"在线人数:233"),o.createElement("span",null,"共发消息数:233")),o.createElement("svg",{className:`icon ${n?fn:gn}`,"aria-hidden":"true",onTouchStart:function(){a((e=>!e))}},o.createElement("use",{xlinkHref:n?"#icon-fjxiangxiala":"#icon-xiala"}))))}));class yn extends o.Component{constructor(){super(...arguments),r(this,"state",{activeItem:0})}componentDidMount(){Be(this.containerBox),this.props.history.push("/home/world")}render(){return o.createElement("div",{className:tn,ref:e=>{this.containerBox=e}},o.createElement("div",{className:nn},o.createElement("span",null,o.createElement("svg",{className:"icon","aria-hidden":"true"},o.createElement("use",{xlinkHref:"#icon-sousuo"}))),o.createElement("ul",null,o.createElement(g,{to:"/home/world",className:0===this.state.activeItem?an:"",onClick:()=>{this.setState({activeItem:0})}},"大世界"),o.createElement(g,{to:"/home/photo",className:1===this.state.activeItem?an:"",onClick:()=>{this.setState({activeItem:1})}},"晒皂片"),o.createElement(g,{to:"/home/fruit",className:2===this.state.activeItem?an:"",onClick:()=>{this.setState({activeItem:2})}},"水果摊"),o.createElement(g,{to:"/home/canteen",className:3===this.state.activeItem?an:"",onClick:()=>{this.setState({activeItem:3})}},"小卖部")),o.createElement("span",{onClick:()=>{this.props.history.push("/home/record")}},o.createElement("svg",{className:"icon","aria-hidden":"true"},o.createElement("use",{xlinkHref:"#icon-xiangjizhaoxiang"})))),o.createElement(h,null,o.createElement(E,{path:"/home/",exact:!0,component:Nn}),o.createElement(E,{path:"/home/world",component:Nn}),o.createElement(E,{path:"/home/photo",component:mn}),o.createElement(E,{path:"/home/fruit",component:cn}),o.createElement(E,{path:"/home/canteen",component:ln}),o.createElement(E,{path:"/home/record",component:pn})))}}var In=d(yn);var wn="_container_1pf7h_1",bn="_colse_1pf7h_18",Cn="_topBar_1pf7h_24",Bn="_messageBox_1pf7h_38";function Mn(e){const t=o.useRef(null);return o.useEffect((()=>{t.current.style.top="5px";const e=setTimeout((()=>{t.current.style.top="-100px"}),2500);return()=>{clearTimeout(e)}}),[]),o.createElement("div",{className:wn,ref:t},o.createElement("div",{className:Cn},o.createElement("svg",{className:"icon","aria-hidden":"true"},o.createElement("use",{xlinkHref:"#icon-xiaoxi1"})),o.createElement("label",null,e.title),o.createElement("svg",{className:"icon","aria-hidden":"true"},o.createElement("use",{xlinkHref:"#icon-a-tishi"}))),o.createElement("div",{className:Bn},o.createElement("img",{src:q+"?uid="+e.uid,alt:""}),o.createElement("span",null,e.uname,"：",e.content)),o.createElement("svg",{className:`icon ${bn}`,"aria-hidden":"true",onClick:function(){t.current.style.top="-95px"}},o.createElement("use",{xlinkHref:"#icon-guanbi"})))}function An(e){let t=document.getElementById("message-box");if(t)m.unmountComponentAtNode(t),m.render(o.createElement(Mn,l({},e)),t);else{let t=document.createElement("div");t.id="message-box",document.body.appendChild(t),m.render(o.createElement(Mn,l({},e)),t)}}var Ln=d(u((e=>({chatInfo:e.chatInfo,worldInfo:e.worldInfo})),{appendMessage:function(e){return{type:"appendMessage",data:e}},appendWorldInfo:function(e){return{type:"appendWorldInfo",data:e}}})((function(e){return o.useEffect((()=>{const{_id:t,user_name:n}=JSON.parse(window.sessionStorage.user_info),a=C.createSocket(t,n);return a.on("reply_private_chat",(t=>{const{uid:n,uname:a,message:s}=t;e.appendMessage(t),console.log("接收到的聊天数据",t),"/privateChat"!==e.history.location.pathname&&An({title:"有朋友的消息噢~",uid:n,uname:a,content:s})})),a.on("reply_world_chat",(t=>{console.log("接收到的世界消息",t);const{uid:n,uname:a,message:s,time:l}=t;e.appendWorldInfo(t),"/worldChat"!=e.history.location.pathname&&An({title:"大世界消息",uid:n,uname:a,content:s})})),a.on("reply_friend_request",(e=>{$({type:"success",text:"宁有一条好友申请噢~",time:3e3}),console.log("收到好友申请",e)})),a.on("reply_request_result",(e=>{const{uid:t,fid:n,status:a}=e;2===a?$({type:"success",text:"好友申请已通过~",time:3e3}):3===a&&$({type:"warning",text:"好友申请被拒绝了~",time:3e3}),console.log("收到申请通知:",e)})),()=>{}}),[]),o.createElement("div",{className:"App"},o.createElement(Ce,null),o.createElement(o.Fragment,null,o.createElement(h,null,o.createElement(E,{path:"/home",component:In}),o.createElement(E,{path:"/privateChat",exact:!0,component:le}),o.createElement(E,{path:"/worldChat",exact:!0,component:ge}),o.createElement(E,{path:"/friends",component:Ht}),o.createElement(E,{path:"/message",component:en}),o.createElement(E,{path:"/profile",component:at}),o.createElement(f,{to:"/home"}))),o.createElement(Ie,null))})));var Jn="_Login_19tsp_2",Rn="_title_19tsp_13",Hn="_log_19tsp_24",On="_input_container_19tsp_38",Tn="_checkbox_19tsp_49",jn="_input_account_19tsp_53",Qn="_input_password_19tsp_53",Fn="_btn_login_19tsp_78",qn="_btn_register_19tsp_78";var zn="_register_container_1c7n9_2",Dn="_topBar_1c7n9_11",Un="_back_btn_1c7n9_18",Zn="_welcome_1c7n9_29",Gn="_register_input_1c7n9_51",Wn="_confirm_btn_1c7n9_88";class Kn extends o.Component{constructor(){super(...arguments),r(this,"handleRegister",(()=>{const e=this.accountElem.value,t=this.pwdElem.value,n=this.repwdElem.value;""===e?alert("请输入账号~"):""===t?alert("请输入密码~"):""===n?alert("请确认密码~"):/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/.test(e)?/^[A-Za-z0-9]+$/.test(t)?t!==n?alert("两次输入的密码不一致~"):z({url:"/user/register",method:"post",data:{account:e,password:t}}).then((t=>{console.log(t),t.data.isRegister&&(this.props.setAccount(e),this.clearRegisterData(),this.props.goToLogin(),$({type:"success",text:"注册成功!",time:2e3}))})).catch((e=>{console.log(e)})):alert("密码只能由数字和字母组成~"):alert("请输入正确的邮箱格式~")}))}componentDidMount(){}clearRegisterData(){this.accountElem.value="",this.pwdElem.value="",this.repwdElem.value=""}render(){return o.createElement("div",{className:zn},o.createElement("h2",{className:Dn},o.createElement("span",{className:Un,onTouchEnd:this.props.goToLogin}),"注册"),o.createElement("div",{className:Zn},o.createElement("div",null,o.createElement("h1",null,"Hi,欢迎加入！"),o.createElement("hr",null),o.createElement("p",null,"WebChat,一个在web网页上面的即时聊天应用")),o.createElement("img",{src:"./assets/Log.a5585a7e.jpg",alt:""})),o.createElement("div",{className:Gn},o.createElement("ul",null,o.createElement("li",null,o.createElement("label",null,"邮箱"),o.createElement("input",{ref:e=>{this.accountElem=e},type:"text",placeholder:"输入邮箱作为账号"})),o.createElement("li",null,o.createElement("label",null,"密码"),o.createElement("input",{ref:e=>{this.pwdElem=e},type:"text",placeholder:"输入密码"})),o.createElement("li",null,o.createElement("label",null,"确认密码"),o.createElement("input",{ref:e=>{this.repwdElem=e},type:"text",placeholder:"请确认密码"})))),o.createElement("button",{className:Wn,onTouchEnd:this.handleRegister},"确认注册"))}}class Yn extends o.Component{constructor(){super(...arguments),r(this,"state",{isShowRegister:!1,isRemember:!1}),r(this,"handleLogin",(()=>{const e=this.accountElem.value,t=this.passwordElem.value;/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/.test(e)?(console.log("true"),""!==t?z({url:"/user/login",method:"post",data:{account:e,password:t}}).then((n=>{if(console.log(n),n.data.isLogin){$({type:"success",text:"登录成功!",time:3e3});const{_id:a}=n.data.data;let{sessionStorage:s}=window;s.setItem("user_info",JSON.stringify(n.data.data)),this.state.isRemember?localStorage.setItem("user_login",JSON.stringify({_id:a,account:e,password:t})):localStorage.setItem("user_login",JSON.stringify({_id:a,account:e,password:""})),setTimeout((()=>{window.location.reload()}),1e3)}else alert("请检查账号和密码~")})):alert("你还没有输入密码~")):""==e?alert("请输入账号~"):alert("你的邮箱格式错误~"),console.log(e,t)})),r(this,"setAccount",(e=>{this.accountElem.value=e})),r(this,"goToLogin",(()=>{this.setState({isShowRegister:!1}),this.container.style.display="block"})),r(this,"goToRegister",(()=>{this.setState({isShowRegister:!0}),setTimeout((()=>{this.container.style.display="none"}),200)})),r(this,"changeRemember",(e=>{this.setState((e=>({isRemember:!e.isRemember})),(()=>{console.log(this.state.isRemember)}))}))}componentDidMount(){const{localStorage:e}=window;if(console.log(e.getItem("user_login")),e.getItem("user_login")){const t=JSON.parse(e.getItem("user_login"));this.accountElem.value=t.account,this.passwordElem.value=t.password}else console.log("没有读取到本地的登录信息...")}render(){return o.createElement(o.Fragment,null,this.state.isShowRegister?o.createElement(Kn,{setAccount:this.setAccount,goToLogin:this.goToLogin}):o.createElement(o.Fragment,null),o.createElement("div",{className:Jn,ref:e=>{this.container=e}},o.createElement("h2",{className:Rn},"WebChat"),o.createElement("div",{className:Hn}),o.createElement("h2",null,"Hi,欢迎登录!"),o.createElement("ul",{className:On},o.createElement("li",null,o.createElement("input",{type:"text",ref:e=>{this.accountElem=e},className:jn,placeholder:"请输入邮箱账号"})),o.createElement("li",null,o.createElement("input",{type:"text",ref:e=>{this.passwordElem=e},className:Qn,placeholder:"请输入密码"})),o.createElement("li",{className:Tn},o.createElement("input",{type:"checkbox",name:"remember",value:"0",onChange:this.changeRemember})," 记住密码"),o.createElement("li",null,o.createElement("button",{className:Fn,onTouchEnd:this.handleLogin},"登录")),o.createElement("li",null,o.createElement("button",{className:qn,onTouchEnd:this.goToRegister},"注册")))))}}const Pn=[];const Vn=[];const Xn=k(v({chatInfo:function(e=Pn,t){const{type:n,data:a}=t;switch(n){case"appendMessage":return[...e,a];case"sendMessage":return C.privateChat(a),[...e,a];case"initMessage":return e=a.messages,a.callback(),e;case"clearMessage":return e=[];default:return e}},worldInfo:function(e=Vn,t){const{type:n,data:a}=t;switch(n){case"appendWorldInfo":return[...e,a];case"sendWorldInfo":return C.sendWorldMessage(a.message),a.callback(),[...e,a.message];case"clearWorldInfo":return e=[],a.callback(),e;default:return e}}}),S(x(N)));var $n="";localStorage.user_login&&($n=JSON.parse(localStorage.user_login)._id);let{sessionStorage:ea}=window;null!==ea.getItem("user_info")?m.render(o.createElement(o.StrictMode,null,o.createElement(y,{basename:"/WebChat"},o.createElement(I,{store:Xn},o.createElement(Ln,null)))),document.getElementById("root")):m.render(o.createElement(o.StrictMode,null,o.createElement(Yn,null)),document.getElementById("root")),window.onload=function(){console.log("页面加载"),window.onunload=function(){console.log("页面刷新"),window.onbeforeunload=function(){console.log("页面关闭"),C.closeSocket($n)}}};
